
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>deep_cave.registry package &#8212; deep_cave bab028ca6b161db07f08a2c5597fdd1ab150b816 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="deep_cave.server package" href="deep_cave.server.html" />
    <link rel="prev" title="deep_cave.logger package" href="deep_cave.logger.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="deep-cave-registry-package">
<h1>deep_cave.registry package<a class="headerlink" href="#deep-cave-registry-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-deep_cave.registry.abstract_registry">
<span id="deep-cave-registry-abstract-registry-module"></span><h2>deep_cave.registry.abstract_registry module<a class="headerlink" href="#module-deep_cave.registry.abstract_registry" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="deep_cave.registry.abstract_registry.AbstractRegistry">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">deep_cave.registry.abstract_registry.</span></span><span class="sig-name descname"><span class="pre">AbstractRegistry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_location</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deep_cave.registry.abstract_registry.AbstractRegistry" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></p>
<p>Blueprint and interface for the implementation of ONNXRegistry.</p>
<dl class="py property">
<dt class="sig sig-object py" id="deep_cave.registry.abstract_registry.AbstractRegistry.format">
<em class="property"><span class="pre">abstract</span> <span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">format</span></span><em class="property"><span class="pre">:</span> <span class="pre">str</span></em><a class="headerlink" href="#deep_cave.registry.abstract_registry.AbstractRegistry.format" title="Permalink to this definition">¶</a></dt>
<dd><p>Maybe useful later, when there is more than one serialization format for models.</p>
<blockquote>
<div><p>Returns a string matching the format this class uses.</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_cave.registry.abstract_registry.AbstractRegistry.get_surrogate">
<em class="property"><span class="pre">abstract</span> </em><span class="sig-name descname"><span class="pre">get_surrogate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#deep_cave.registry.onnx_surrogate.ONNXSurrogate" title="deep_cave.registry.onnx_surrogate.ONNXSurrogate"><span class="pre">deep_cave.registry.onnx_surrogate.ONNXSurrogate</span></a><a class="headerlink" href="#deep_cave.registry.abstract_registry.AbstractRegistry.get_surrogate" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface for retrieving the model based on its unique model id. Mapping and id come from Store.</p>
<dl class="simple">
<dt>model_id</dt><dd><p>str. Unqiue model id.</p>
</dd>
<dt>mapping</dt><dd><p>Dict. Mapping between model input requirements and features in the trial data.</p>
</dd>
</dl>
<blockquote>
<div><p>Return the surrogate as ONNXSurrogate model, which is compatible with sklearn.</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_cave.registry.abstract_registry.AbstractRegistry.log_surrogate_model">
<em class="property"><span class="pre">abstract</span> </em><span class="sig-name descname"><span class="pre">log_surrogate_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">onnx.onnx_ml_pb2.ModelProto</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#deep_cave.registry.abstract_registry.AbstractRegistry.log_surrogate_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface for saving the actual model. Every model gets an unique id string, which links it to the meta
data in model_id.</p>
<dl class="simple">
<dt>model</dt><dd><p>onnx.ModelProto. The model converted into ONNX proto format.</p>
</dd>
<dt>model_id</dt><dd><p>Unique string provided by the system</p>
</dd>
</dl>
<blockquote>
<div><p>Nothing.</p>
</div></blockquote>
</dd></dl>

</dd></dl>

</section>
<section id="module-deep_cave.registry.onnx_registry">
<span id="deep-cave-registry-onnx-registry-module"></span><h2>deep_cave.registry.onnx_registry module<a class="headerlink" href="#module-deep_cave.registry.onnx_registry" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_registry.ONNXRegistry">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">deep_cave.registry.onnx_registry.</span></span><span class="sig-name descname"><span class="pre">ONNXRegistry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_location</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deep_cave.registry.onnx_registry.ONNXRegistry" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deep_cave.registry.abstract_registry.AbstractRegistry" title="deep_cave.registry.abstract_registry.AbstractRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">deep_cave.registry.abstract_registry.AbstractRegistry</span></code></a></p>
<p>Based on the save_location a model is saved under the model_id for later retrieval.</p>
<p>Missing. Extension for saving and retrieving with different protocols. As it was done in Store.</p>
<dl class="py property">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_registry.ONNXRegistry.format">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">format</span></span><em class="property"><span class="pre">:</span> <span class="pre">str</span></em><a class="headerlink" href="#deep_cave.registry.onnx_registry.ONNXRegistry.format" title="Permalink to this definition">¶</a></dt>
<dd><p>Maybe useful later, when there is more than one serialization format for models. Currently, ONNX is the
only one.</p>
<blockquote>
<div><p>The format used for saving. Always onnx.</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_registry.ONNXRegistry.get_surrogate">
<span class="sig-name descname"><span class="pre">get_surrogate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#deep_cave.registry.onnx_surrogate.ONNXSurrogate" title="deep_cave.registry.onnx_surrogate.ONNXSurrogate"><span class="pre">deep_cave.registry.onnx_surrogate.ONNXSurrogate</span></a><a class="headerlink" href="#deep_cave.registry.onnx_registry.ONNXRegistry.get_surrogate" title="Permalink to this definition">¶</a></dt>
<dd><p>Retieve the serialized model, deserialize it and wrap it in an ONNXSurrogate model.
The mapping is considered meta data and mandaged with the Store class.</p>
<dl class="simple">
<dt>model_id</dt><dd><p>str. Unique id, by which the model is referenced.</p>
</dd>
<dt>mapping</dt><dd><p>Dict. The mapping between features and model input.</p>
</dd>
</dl>
<blockquote>
<div><p>Returns an ONNXSurrogate model, which is sklearn compatible.</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_registry.ONNXRegistry.log_surrogate_model">
<span class="sig-name descname"><span class="pre">log_surrogate_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">onnx.onnx_ml_pb2.ModelProto</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#deep_cave.registry.onnx_registry.ONNXRegistry.log_surrogate_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements how to save the model.
Expects the user to generate the onnx.ModelProto from his ML model.</p>
<dl class="simple">
<dt>model</dt><dd><p>onnx.ModelProto. Already transformed surrogate model.</p>
</dd>
<dt>model_id</dt><dd><p>str. Unique name for the model generated by the system for later reference to the meta data.</p>
</dd>
</dl>
<blockquote>
<div><p>Nothing.</p>
</div></blockquote>
</dd></dl>

</dd></dl>

</section>
<section id="module-deep_cave.registry.onnx_surrogate">
<span id="deep-cave-registry-onnx-surrogate-module"></span><h2>deep_cave.registry.onnx_surrogate module<a class="headerlink" href="#module-deep_cave.registry.onnx_surrogate" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_surrogate.ONNXSurrogate">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">deep_cave.registry.onnx_surrogate.</span></span><span class="sig-name descname"><span class="pre">ONNXSurrogate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">onnxruntime.capi.onnxruntime_inference_collection.InferenceSession</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deep_cave.registry.onnx_surrogate.ONNXSurrogate" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.BaseEstimator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.RegressorMixin</span></code></p>
<p>Wrapper model to query onnx inference session with a dataframe.</p>
<p>The Class automatically maps the columns to the correct and expected input.</p>
<p>Currently, only designed for sklearn models and pipelines.</p>
<dl class="py method">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_surrogate.ONNXSurrogate.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deep_cave.registry.onnx_surrogate.ONNXSurrogate.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Here for compatibility. The model is already trained when loaded. Later modifications aren’t possible.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_cave.registry.onnx_surrogate.ONNXSurrogate.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">features_df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.core.frame.DataFrame</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">numpy.ndarray</span><a class="headerlink" href="#deep_cave.registry.onnx_surrogate.ONNXSurrogate.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>For each expected input for the model, the correct features are selected, based on the information given in
mapping. The inputs are also cast to the expected data type.</p>
<p>Then the model infers a prediction from the input. Currently only one output is allowed.
Staying compatible with most sklearn methods.</p>
<dl class="simple">
<dt>features_df</dt><dd><p>trials DataFrame from store.</p>
</dd>
<dt>kwargs</dt><dd><p>Kwargs. Used for compatibility with sklearn.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-deep_cave.registry">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-deep_cave.registry" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="deep_cave.registry.get_surrogate">
<span class="sig-prename descclassname"><span class="pre">deep_cave.registry.</span></span><span class="sig-name descname"><span class="pre">get_surrogate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_location</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#deep_cave.registry.onnx_surrogate.ONNXSurrogate" title="deep_cave.registry.onnx_surrogate.ONNXSurrogate"><span class="pre">deep_cave.registry.onnx_surrogate.ONNXSurrogate</span></a><a class="headerlink" href="#deep_cave.registry.get_surrogate" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the saved model from log_surrogate and return a child class of AbstractSurrogate.</p>
<p>If a sklearn model was logger, it can’t be restored completely. The AbstractSurrogate is the proxy for that.
It allows only to run inference with a DataFrame dataset.</p>
<dl class="simple">
<dt>save_location: str</dt><dd><p>A valid directory to save the model to.</p>
</dd>
<dt>model_id: str</dt><dd><p>The model_id logged in Storage</p>
</dd>
<dt>mapping: Dict</dt><dd><p>This mapping defines which columns of the DataFrame dataset to use when running inference with the
AbstractSurrogate. It also mapps the column names to the onnx input names defined in the onnx.ModelProto</p>
</dd>
</dl>
<p>AbstractSurrogate</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="deep_cave.registry.log_surrogate">
<span class="sig-prename descclassname"><span class="pre">deep_cave.registry.</span></span><span class="sig-name descname"><span class="pre">log_surrogate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_location</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">onnx.onnx_ml_pb2.ModelProto</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deep_cave.registry.log_surrogate" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs an onnx model.</p>
<p>Allows to save surrogate model for later analysis. The model has to be converted into an onnx.ModelProto by the
user.
The model can be restored completely from this representation without any additional dependencies or side effects.
The only requirement is having onnx_runtime installed.</p>
<dl class="simple">
<dt>save_location: str</dt><dd><p>A valid directory to save the model to.</p>
</dd>
<dt>model_id: str</dt><dd><p>The model_id logged in Storage</p>
</dd>
<dt>model: onnx.ModelProto</dt><dd><p>The model proto that is saved to DeepCAVE.</p>
</dd>
</dl>
<p>None.</p>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">deep_cave</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">deep_cave</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="modules.html">deep_cave</a><ul>
  <li><a href="deep_cave.html">deep_cave package</a><ul>
      <li>Previous: <a href="deep_cave.logger.html" title="previous chapter">deep_cave.logger package</a></li>
      <li>Next: <a href="deep_cave.server.html" title="next chapter">deep_cave.server package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Niels Nuthmann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/deep_cave/deep_cave.registry.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>